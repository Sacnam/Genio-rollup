<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Content Tools</title>
  <!-- FontAwesome Locale -->
  <link rel="stylesheet" href="../libs/fontawesome/css/all.min.css">
  <!-- Script Locali -->
  <style>
    :root {
        --popup-width: 350px;
        --popup-bg-color: #f7f9fc;
        --popup-text-color: #2c3e50;
        --popup-secondary-text-color: #566573;
        --popup-border-color: #dadedf;
        --popup-accent-color: #3498db;
        --popup-accent-hover-color: #2980b9;
        --popup-button-text-color: white;
        --popup-info-text-color: #7f8c8d;
        --popup-url-color: #5dade2;
        --popup-input-bg-color: #ffffff;
        --popup-icon-color: #34495e;
        --popup-font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        --popup-border-radius: 6px;
        --popup-shadow-sm: 0 2px 4px rgba(0,0,0,0.06);
        --popup-shadow-md: 0 4px 12px rgba(0,0,0,0.1);
        --popup-shadow-lg: 0 8px 20px rgba(0,0,0,0.12);
    }

    body {
      font-family: var(--popup-font-family);
      margin: 0;
      padding: 10px 12px;
      width: var(--popup-width);
      max-height: 580px;
      display: flex;
      flex-direction: column;
      background-color: var(--popup-bg-color);
      color: var(--popup-text-color);
      font-size: 14px;
    }

    #auth-block {
      text-align: center; padding: 20px 15px; border: 1px solid var(--popup-border-color);
      background-color: var(--popup-input-bg-color); border-radius: var(--popup-border-radius);
      margin-top: 15px; box-shadow: var(--popup-shadow-md);
    }
    #auth-block p { margin: 0 0 15px 0; font-size: 0.95em; }
    #open-auth-page-btn {
      background-color: var(--popup-accent-color); color: var(--popup-button-text-color);
      border: none; padding: 9px 16px; border-radius: var(--popup-border-radius);
      cursor: pointer; font-size: 0.9em; font-weight: 500; transition: background-color 0.2s;
      box-shadow: var(--popup-shadow-sm);
    }
    #open-auth-page-btn:hover { background-color: var(--popup-accent-hover-color); box-shadow: var(--popup-shadow-md); }

    #controls-container { display: none; flex-direction: column; flex-grow: 1; }

    .top-bar {
      display: flex; justify-content: flex-start;
      align-items: center; margin-bottom: 10px; padding-bottom: 8px;
      border-bottom: 1px solid var(--popup-border-color); height: 32px;
    }
    .icon-btn {
      background: transparent; border: none; cursor: pointer; padding: 5px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%; transition: background-color 0.15s; color: var(--popup-icon-color);
    }
    .icon-btn:hover { background-color: color-mix(in srgb, var(--popup-border-color) 50%, transparent); }
    .icon-btn i {
      font-size: 18px;
      opacity: 0.85;
    }
    .icon-btn:hover i { opacity: 1; }

    details#markdown-drawer {
        margin-bottom: 12px;
        border: 1px solid var(--popup-border-color);
        border-radius: var(--popup-border-radius);
        background-color: var(--popup-input-bg-color);
        box-shadow: var(--popup-shadow-md);
    }
    summary#markdown-drawer-summary {
      font-weight: 600;
      padding: 8px 12px;
      cursor: pointer; outline: none;
      border-radius: var(--popup-border-radius);
      transition: background-color 0.15s;
      list-style-position: inside;
      color: var(--popup-text-color);
    }
    details#markdown-drawer:not([open]) summary#markdown-drawer-summary:hover {
        background-color: color-mix(in srgb, var(--popup-border-color) 30%, transparent);
    }
    details#markdown-drawer[open] summary#markdown-drawer-summary {
        border-bottom: 1px solid var(--popup-border-color);
        border-top-left-radius: var(--popup-border-radius);
        border-top-right-radius: var(--popup-border-radius);
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }

    .page-info-container {
        text-align: center;
        padding: 2px 0;
    }
    h1#page-title {
      font-size: 1.05em; font-weight: 600;
      margin: 0 0 2px 0; line-height: 1.25; word-break: break-word;
      color: var(--popup-text-color);
    }
    div#page-url {
      font-size: 0.7em; color: var(--popup-url-color); margin-bottom: 0;
      word-break: break-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    textarea#markdown-content {
      width: calc(100% - 20px); margin: 10px;
      padding: 8px; box-sizing: border-box;
      border: 1px solid var(--popup-border-color);
      border-radius: calc(var(--popup-border-radius) - 2px);
      font-size: 0.85em; background-color: var(--popup-input-bg-color);
      color: var(--popup-text-color); height: 120px;
      resize: vertical; font-family: "SFMono-Regular", Consolas, Menlo, monospace;
      line-height: 1.45; box-shadow: var(--popup-shadow-sm) inset;
    }
    textarea#markdown-content:focus {
        border-color: var(--popup-accent-color);
        box-shadow: 0 0 0 2px color-mix(in srgb, var(--popup-accent-color) 20%, transparent), var(--popup-shadow-sm) inset;
        outline: none;
    }

    .buttons-container {
        display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        margin-top: 0; margin-bottom: 12px; padding: 0 10px;
    }
    .action-btn {
      background-color: var(--popup-accent-color); color: var(--popup-button-text-color);
      border: none; padding: 9px 10px; border-radius: var(--popup-border-radius);
      cursor: pointer; font-size: 0.85em; font-weight: 500;
      transition: background-color 0.2s, box-shadow 0.2s; text-align: center;
      display: flex; align-items: center; justify-content: center; gap: 6px;
      box-shadow: var(--popup-shadow-sm);
    }
    .action-btn i { font-size: 0.95em; color: var(--popup-button-text-color); }
    .action-btn:hover:not(:disabled) {
      background-color: var(--popup-accent-hover-color); box-shadow: var(--popup-shadow-md);
    }
    .action-btn:disabled {
      background-color: color-mix(in srgb, var(--popup-secondary-text-color) 40%, transparent);
      color: var(--popup-info-text-color); cursor: not-allowed; box-shadow: none;
    }
    .action-btn:disabled i { opacity: 0.7; }

    details#rss-manual-drawer {
        border: 1px solid var(--popup-border-color);
        border-radius: var(--popup-border-radius);
        background-color: var(--popup-input-bg-color);
        box-shadow: var(--popup-shadow-md);
        margin-bottom: 10px;
    }
    details#rss-manual-drawer summary {
        font-weight: 600; padding: 8px 12px; cursor: pointer; outline: none;
        color: var(--popup-text-color); border-bottom: 1px solid transparent;
        transition: background-color 0.15s; font-size: 0.9em;
        display: flex; align-items: center; gap: 6px;
        list-style-position: inside;
    }
    details#rss-manual-drawer summary i.fa-rss {
        color: var(--popup-icon-color); font-size: 0.9em;
    }
    details#rss-manual-drawer summary:hover {
        background-color: color-mix(in srgb, var(--popup-border-color) 30%, transparent);
    }
    details#rss-manual-drawer[open] summary {
        border-bottom-color: var(--popup-border-color);
        border-top-left-radius: var(--popup-border-radius);
        border-top-right-radius: var(--popup-border-radius);
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }
    .rss-drawer-content { padding: 10px 12px; }

    #detected-rss-outside {
        margin-bottom: 10px;
        padding: 0 5px;
    }
    #detected-rss-outside .info, #detected-rss-outside p {
      font-size: 0.8em; color: var(--popup-info-text-color); margin: 5px 0; text-align: center;
    }
    .rss-feed-item {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 6px; padding: 7px 9px;
      background-color: var(--popup-input-bg-color);
      border: 1px solid var(--popup-border-color);
      border-radius: var(--popup-border-radius);
      font-size: 0.8em; box-shadow: var(--popup-shadow-sm);
    }
    .rss-feed-item span {
        flex-grow: 1; margin-right: 6px; overflow: hidden; text-overflow: ellipsis;
        white-space: nowrap; color: var(--popup-text-color);
    }
    .subscribe-btn {
      background-color: var(--popup-accent-color); color: var(--popup-button-text-color);
      border: none; padding: 5px 9px; border-radius: calc(var(--popup-border-radius) - 2px);
      cursor: pointer; font-size: 0.75em; font-weight: 500;
      transition: background-color 0.2s; flex-shrink: 0;
    }
    .subscribe-btn:hover { background-color: var(--popup-accent-hover-color); }

    #custom-feed-container { display: flex; margin-top: 8px; margin-bottom: 8px; }
    #custom-feed-url {
      flex: 1; margin-right: 8px; margin-top: 0; padding: 8px 10px;
      box-sizing: border-box; border: 1px solid var(--popup-border-color);
      border-radius: var(--popup-border-radius); font-size: 0.85em;
      background-color: var(--popup-input-bg-color); color: var(--popup-text-color);
      box-shadow: var(--popup-shadow-sm) inset;
    }
    #custom-feed-url:focus {
        border-color: var(--popup-accent-color);
        box-shadow: 0 0 0 2px color-mix(in srgb, var(--popup-accent-color) 20%, transparent), var(--popup-shadow-sm) inset;
        outline: none;
    }
    #add-custom-feed {
      background-color: #27ae60; color: var(--popup-button-text-color); border: none; padding: 8px 12px;
      border-radius: var(--popup-border-radius); cursor: pointer; font-size: 0.8em;
      font-weight: 500; transition: background-color 0.2s; flex-shrink: 0;
      box-shadow: var(--popup-shadow-sm);
    }
    #add-custom-feed:hover { background-color: #229954; box-shadow: var(--popup-shadow-md); }

    .info { font-size: 0.8em; color: var(--popup-info-text-color); margin-top: 4px; line-height: 1.3; }
    .error-text { color: #e74c3c !important; font-weight: 500; }

    ::-webkit-scrollbar { width: 7px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: color-mix(in srgb, var(--popup-border-color) 80%, transparent); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: color-mix(in srgb, var(--popup-secondary-text-color) 80%, transparent); }
  </style>
</head>
<body>
  <div id="auth-block" style="display: none;">
    <p>You need to log in to use these features.</p>
    <button id="open-auth-page-btn">Login / Register</button>
  </div>

  <div id="controls-container">
    <div class="top-bar">
      <button id="open-manager-btn" class="icon-btn" title="Saved Pages Manager">
        <i class="fas fa-book-reader"></i>
      </button>
    </div>

    <details id="markdown-drawer" open>
        <summary id="markdown-drawer-summary">
            <div class="page-info-container">
                <h1 id="page-title">Loading title...</h1>
                <div id="page-url" class="info">Loading URL...</div>
            </div>
        </summary>
        <textarea id="markdown-content" placeholder="No preview available..." readonly></textarea>
    </details>

    <div class="buttons-container">
      <button id="save-reader-button" class="action-btn" disabled>
        <i class="fas fa-bookmark"></i> Save
      </button>
      <button id="download-md-button" class="action-btn" disabled>
        <i class="fas fa-download"></i> Download .md
      </button>
    </div>

    <details id="rss-manual-drawer" open>
        <summary><i class="fas fa-rss"></i> Manual RSS Feed</summary>
        <div class="rss-drawer-content">
            <div id="custom-feed-container">
                <input type="text" id="custom-feed-url" placeholder="Paste RSS feed URL">
                <button id="add-custom-feed">Add</button>
            </div>
        </div>
    </details>

    <div id="detected-rss-outside">
        <p class="info">Searching for feeds...</p>
    </div>

  </div>
  
  <!-- Il tuo script popup.js (caricato come modulo) -->
  <script src="popup.js" type="module"></script>
</body>
</html>